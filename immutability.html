<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">

<!-- Mirrored from qedcode.com/immutability by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 13 Jan 2017 12:21:16 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Immutability | Q.E.D. Code</title>
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="prev" href="prerequisites.html" />
<link rel="up" href="theory.html" />
<link rel="next" href="closure.html" />
<link rel="shortcut icon" href="http://qedcode.com/misc/favicon.ico" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="http://qedcode.com/modules/book/book.css?2" />
<link type="text/css" rel="stylesheet" media="all" href="http://qedcode.com/modules/node/node.css?2" />
<link type="text/css" rel="stylesheet" media="all" href="http://qedcode.com/modules/system/defaults.css?2" />
<link type="text/css" rel="stylesheet" media="all" href="http://qedcode.com/modules/system/system.css?2" />
<link type="text/css" rel="stylesheet" media="all" href="http://qedcode.com/modules/system/system-menus.css?2" />
<link type="text/css" rel="stylesheet" media="all" href="http://qedcode.com/modules/user/user.css?2" />
<link type="text/css" rel="stylesheet" media="all" href="http://qedcode.com/sites/all/modules/mollom/mollom.css?2" />
<link type="text/css" rel="stylesheet" media="all" href="http://qedcode.com/sites/all/modules/views/css/views.css?2" />
<link type="text/css" rel="stylesheet" media="all" href="http://qedcode.com/modules/comment/comment.css?2" />
<link type="text/css" rel="stylesheet" media="all" href="http://qedcode.com/themes/theme073/style.css?2" />
  <script type="text/javascript" src="http://qedcode.com/misc/jquery.js?2"></script>
<script type="text/javascript" src="http://qedcode.com/misc/drupal.js?2"></script>
<script type="text/javascript" src="http://qedcode.com/sites/all/modules/google_analytics/googleanalytics.js?2"></script>
<script type="text/javascript" src="http://qedcode.com/sites/all/modules/mollom/mollom.js?2"></script>
<script type="text/javascript">
<!--//--><![CDATA[//><!--
jQuery.extend(Drupal.settings, { "basePath": "/", "googleanalytics": { "trackOutbound": 1, "trackMailto": 1, "trackDownload": 1, "trackDownloadExtensions": "7z|aac|arc|arj|asf|asx|avi|bin|csv|doc|exe|flv|gif|gz|gzip|hqx|jar|jpe?g|js|mp(2|3|4|e?g)|mov(ie)?|msi|msp|pdf|phps|png|ppt|qtm?|ra(m|r)?|sea|sit|tar|tgz|torrent|txt|wav|wma|wmv|wpd|xls|xml|z|zip" } });
//--><!]]>
</script>
  
</head>
  
<body>
    <table id="main">
        <tr>
            <td width="100%" class="header">
            	<div class="top-left">
                	<div class="top-right">
                    	<table width="100%">
                            <tr>
                                <td width="100%" style="height:195px;">
                                    <table width="100%">
                                        <tr>
                                            <td width="">
                                                                                                    <a href="index.html" title="Home"><img src="http://qedcode.com/themes/theme073/images/logo.png" alt="Home" border="0" class="logo" /></a><br />
                                                                                                                                                
                                                                                            </td>
                                            <td width="270">
                                                <div class="search-box">
                                                                                                    </div>
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                            </tr>
                            <tr>
                                <td width="100%" style="height:54px;">
                                                                            <div class="pr-menu">
                                            <ul class="links primary-links"><li class="menu-227 first"><a href="node.html" title="">Latest Article</a></li>
<li class="menu-339"><a href="podcast.html" title="Q.E.D. Code Podcast">Podcast</a></li>
<li class="menu-219"><a href="theory.html" title="">Theory</a></li>
<li class="menu-220"><a href="practice.html" title="">Practice</a></li>
<li class="menu-221 last"><a href="speaking.html" title="">Speaking</a></li>
</ul>                                            <br class="clear" />
                                        </div>
                                                                    </td>
                            </tr>
                        </table>
                    </div>
                </div>
            </td>
        </tr>
        <tr>
            <td width="100%">
                <table width="100%" >
                    <tr>
                        <td width="189">
                            <div class="left2">
                                                                    <table width="100%">
                                      <tr>
                                        <td width="100%">
                                            <div class="block block-block" id="block-block-2">
	<div class="block-bot">
    	<div class="block-top">
        	<div class="block-indent">
                <div class="title">
                    <h3>About me</h3>
                </div>
                <div class="content"><div style="margin: 15px;">
<p style="margin-bottom: 7px;">Michael L Perry</p>
<p><a href="http://improvingenterprises.com/"><img src="images/IE-Logo.png" width="145" alt="Improving Enterprises" /></a></p>
<p style="margin-bottom: 15px;">Principal Consultant</p>
<p><a href="http://twitter.com/michaellperry">@michaellperry</a></p>
</div>
</div>
            </div>
        </div>
    </div>
</div><div class="block block-user" id="block-user-0">
	<div class="block-bot">
    	<div class="block-top">
        	<div class="block-indent">
                <div class="title">
                    <h3>User login</h3>
                </div>
                <div class="content"><form action="http://qedcode.com/immutability?destination=node%2F5"  accept-charset="UTF-8" method="post" id="user-login-form">
<div><div class="form-item" id="edit-name-wrapper">
 <label for="edit-name">Username: <span class="form-required" title="This field is required.">*</span></label>
 <input type="text" maxlength="60" name="name" id="edit-name" size="15" value="" class="form-text required" />
</div>
<div class="form-item" id="edit-pass-wrapper">
 <label for="edit-pass">Password: <span class="form-required" title="This field is required.">*</span></label>
 <input type="password" name="pass" id="edit-pass"  maxlength="60"  size="15"  class="form-text required" />
</div>
<input type="submit" name="op" id="edit-submit" value="Log in"  class="form-submit" />
<div class="item-list"><ul><li class="first last"><a href="user/password.html" title="Request new password via e-mail.">Request new password</a></li>
</ul></div><input type="hidden" name="form_build_id" id="form-d0b3aadcd09f8d315bff2d7da26b044d" value="form-d0b3aadcd09f8d315bff2d7da26b044d"  />
<input type="hidden" name="form_id" id="edit-user-login-block" value="user_login_block"  />

</div></form>
</div>
            </div>
        </div>
    </div>
</div>                                        </td>
                                      </tr>
                                    </table>
                                                            </div>
                        </td>
                        <td width="0">
                            <div class="right2">
                                                            </div>
                        </td>
                        <td width="" class="cont-row">
                            <div class="border-left">
                                <div class="border-right">
                                    <div class="border-bot">
                                        <div class="border-top">
                                            <div class="corner-bot-left">
                                                <div class="corner-bot-right">
                                                    <div class="corner-top-left">
                                                        <div class="corner-top-right">
                                                            <div class="cent">
                                                                                                                                                                                                
                                                                                                                        
                                                                <h2>Immutability</h2>
                                                                                                                                                                                                                                                                 
                                                                                                                    
                                                                                                                    
                                                              <!-- start main content -->
                                                            <div class="node">
	    <div class="taxonomy"></div>
  
    <div class="content"><p>The constructor has a very powerful contract, and one that the compiler proves. The constructor is called once and only once.</p>
<p>We can use this promise to prove some very useful things. We can prove that required properties are set. We can prove that A happens before B (as we can with other <a href="prerequisites.html">prerequisite techniques</a>). But more strongly, we can prove that A <em>does not</em> happen <em>after</em> B.</p>
<p><strong>Required properties</strong><br />A constructor has to be called. There is no other way to get an instance of an object. If there are any required properties, they should be constructor parameters. Otherwise, there is no way to prove that they've been set.</p>
<pre><span style="color: blue">class</span> ReportRequest
{
    <span style="color: green">// Required parameters.</span>
    <span style="color: blue">private</span> User _requestedBy;
    <span style="color: blue">private</span> Company _requestedFor;

    <span style="color: green">// Optional parameters.</span>
    <span style="color: blue">private</span> DateTime? _fromDate;
    <span style="color: blue">private</span> DateTime? _toDate;

    <span style="color: blue">public</span> ReportRequest(User requestedBy, Company requestedFor)
    {
        _requestedBy = requestedBy;
        _requestedFor = requestedFor;
    }

    <span style="color: blue">public</span> User RequestedBy
    {
        <span style="color: blue">get</span> { <span style="color: blue">return</span> _requestedBy; }
    }

    <span style="color: blue">public</span> Company RequestedFor
    {
        <span style="color: blue">get</span> { <span style="color: blue">return</span> _requestedFor; }
    }

    <span style="color: blue">public</span> DateTime? FromDate
    {
        <span style="color: blue">get</span> { <span style="color: blue">return</span> _fromDate; }
        <span style="color: blue">set</span> { _fromDate = value; }
    }

    <span style="color: blue">public</span> DateTime? ToDate
    {
        <span style="color: blue">get</span> { <span style="color: blue">return</span> _toDate; }
        <span style="color: blue">set</span> { _toDate = value; }
    }
}</pre><p>We can prove that the user requesting the report and the company for which the report is requested are specified. The filter parameters are optional.</p>
<p><strong>Immutable properties</strong><br />Once a constructor is called, it cannot be called again. This is an extremely powerful contract, and can be used to prove that properties can't change. In the above example, the RequestedBy and RequestedFor properties are immutable. They can only be set by the constructor, which can only be called once.</p>
<p>Immutability is an example of the statement A does not happen after B. A) the property changes. B) the property is set. The property does not change after it is set.</p>
<p>There are other statements of this form that the constructor can prove. For example, a connection string cannot change after a database connection has been established. Here's a snippet of the ADO.NET SqlConnection class:</p>
<pre><span style="color: blue">public</span> <span style="color: blue">class</span> SqlConnection
{
    <span style="color: blue">public</span> SqlConnection();
    <span style="color: blue">public</span> SqlConnection(<span style="color: blue">string</span> connectionString);
    <span style="color: blue">public</span> <span style="color: blue">string</span> ConnectionString { <span style="color: blue">get</span>; <span style="color: blue">set</span>; }
}</pre><p>Do you see the problem? You cannot prove that the connection string does not change. This class has guard code that throws an exception if you do so. It would be a simple change to make this contract provable:</p>
<pre><span style="color: blue">public</span> <span style="color: blue">class</span> SqlConnection
{
    <span style="color: blue">public</span> SqlConnection(<span style="color: blue">string</span> connectionString);
    <span style="color: blue">public</span> <span style="color: blue">string</span> ConnectionString { <span style="color: blue">get</span>; }
}</pre><p><strong>Don't waste the constructor</strong><br />Using a constructor to prove a contract is a powerful capability. It is weakened when the constructor is used for other things.</p>
<pre><span style="color: blue">public</span> <span style="color: blue">class</span> User
{
    <span style="color: blue">private</span> <span style="color: blue">string</span> _userId;
    <span style="color: blue">private</span> <span style="color: blue">string</span> _firstName;
    <span style="color: blue">private</span> <span style="color: blue">string</span> _lastName;

    <span style="color: blue">public</span> User(<span style="color: blue">string</span> userId) :
        <span style="color: blue">this</span>(userId, <span style="color: blue">string</span>.Empty, <span style="color: blue">string</span>.Empty)
    {
    }

    <span style="color: blue">public</span> User(<span style="color: blue">string</span> userId, <span style="color: blue">string</span> firstName, <span style="color: blue">string</span> lastName)
    {
        _userId = userId;
        _firstName = firstName;
        _lastName = lastName;
    }

    <span style="color: blue">public</span> <span style="color: blue">string</span> UserId
    {
        <span style="color: blue">get</span> { <span style="color: blue">return</span> _userId; }
    }

<span style="color: blue"><font color="#000000">    </font>public</span> <span style="color: blue">string</span> FirstName
    {
        <span style="color: blue">get</span> { <span style="color: blue">return</span> _firstName; }
        <span style="color: blue">set</span> { _firstName = value; }
    }

    <span style="color: blue">public</span> <span style="color: blue">string</span> LastName
    {
        <span style="color: blue">get</span> { <span style="color: blue">return</span> _lastName; }
        <span style="color: blue">set</span> { _lastName = value; }
    }
}</pre><p>This class has a weak constructor. The name of a user can change, but the ID cannot. An overloaded constructor initializing the name is provided for convenience. But this convenience comes at a price. It is more difficult to see that the user ID is required and immutable. It's still provable, but that information is not called out.</p>
<p>Don't overload the constructor. Don't use it for convenience. Don't initialize mutable properties. When a constructor is used only to set required and immutable properties, the intent is clear, and the proof is easy.</p>
  <div id="book-navigation-3" class="book-navigation">
    
        <div class="page-links clear-block">
              <a href="prerequisites.html" class="page-previous" title="Go to previous page">‹ Prerequisites</a>
                    <a href="theory.html" class="page-up" title="Go to parent page">up</a>
                    <a href="closure.html" class="page-next" title="Go to next page">Closure ›</a>
          </div>
    
  </div>
</div>
    <br />
        	<div class="links-align">
            <div class="bg-links">
                <div class="links-left">
                    <div class="links-right">
                        <div class="links"><ul class="links inline"><li class="blog_usernames_blog first"><a href="blogs/michael-l-perry.html" title="Read Michael L Perry&#039;s latest blog entries.">Michael L Perry&#039;s blog</a></li>
<li class="comment_add last"><a href="http://qedcode.com/comment/reply/5#comment-form" title="Share your thoughts and opinions related to this posting.">Add new comment</a></li>
</ul></div>
                    </div>
                </div>
            </div>
        </div>
	    <br class="clear" />    
    </div>                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </td>
                    </tr>
                </table>
            </td>
        </tr>
    </table>
    <div id="footer">
    	<div class="foot">
        	                <span><a rel="license" href="http://creativecommons.org/licenses/by/3.0/us/"><img alt="Creative Commons License" src="../licensebuttons.net/l/by/3.0/us/88x31.png" /></a><br /><span dc="http://purl.org/dc/elements/1.1/" href="http://purl.org/dc/dcmitype/Text" property="title" rel="type">Q.E.D. Code</span> by <a cc="http://creativecommons.org/ns#" href="index.html" property="attributionName" rel="attributionURL">Michael L Perry</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/3.0/us/">Creative Commons Attribution 3.0 United States License</a>.</span>
                    </div>
    </div>
<script type="text/javascript">
<!--//--><![CDATA[//><!--
var _gaq = _gaq || [];_gaq.push(["_setAccount", "UA-389401-7"]);_gaq.push(["_trackPageview"]);(function() {var ga = document.createElement("script");ga.type = "text/javascript";ga.async = true;ga.src = ("https:" == document.location.protocol ? "https://ssl" : "http://www") + ".google-analytics.com/ga.js";var s = document.getElementsByTagName("script")[0];s.parentNode.insertBefore(ga, s);})();
//--><!]]>
</script>
</body>

<!-- Mirrored from qedcode.com/immutability by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 13 Jan 2017 12:21:16 GMT -->
</html>
