<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">

<!-- Mirrored from qedcode.com/content/line-business-applications-xaml by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 13 Jan 2017 12:22:20 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Line of business applications in XAML | Q.E.D. Code</title>
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="http://qedcode.com/misc/favicon.ico" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="http://qedcode.com/modules/book/book.css?2" />
<link type="text/css" rel="stylesheet" media="all" href="http://qedcode.com/modules/node/node.css?2" />
<link type="text/css" rel="stylesheet" media="all" href="http://qedcode.com/modules/system/defaults.css?2" />
<link type="text/css" rel="stylesheet" media="all" href="http://qedcode.com/modules/system/system.css?2" />
<link type="text/css" rel="stylesheet" media="all" href="http://qedcode.com/modules/system/system-menus.css?2" />
<link type="text/css" rel="stylesheet" media="all" href="http://qedcode.com/modules/user/user.css?2" />
<link type="text/css" rel="stylesheet" media="all" href="http://qedcode.com/sites/all/modules/mollom/mollom.css?2" />
<link type="text/css" rel="stylesheet" media="all" href="http://qedcode.com/sites/all/modules/views/css/views.css?2" />
<link type="text/css" rel="stylesheet" media="all" href="http://qedcode.com/modules/comment/comment.css?2" />
<link type="text/css" rel="stylesheet" media="all" href="http://qedcode.com/themes/theme073/style.css?2" />
  <script type="text/javascript" src="http://qedcode.com/misc/jquery.js?2"></script>
<script type="text/javascript" src="http://qedcode.com/misc/drupal.js?2"></script>
<script type="text/javascript" src="http://qedcode.com/sites/all/modules/google_analytics/googleanalytics.js?2"></script>
<script type="text/javascript" src="http://qedcode.com/sites/all/modules/mollom/mollom.js?2"></script>
<script type="text/javascript">
<!--//--><![CDATA[//><!--
jQuery.extend(Drupal.settings, { "basePath": "/", "googleanalytics": { "trackOutbound": 1, "trackMailto": 1, "trackDownload": 1, "trackDownloadExtensions": "7z|aac|arc|arj|asf|asx|avi|bin|csv|doc|exe|flv|gif|gz|gzip|hqx|jar|jpe?g|js|mp(2|3|4|e?g)|mov(ie)?|msi|msp|pdf|phps|png|ppt|qtm?|ra(m|r)?|sea|sit|tar|tgz|torrent|txt|wav|wma|wmv|wpd|xls|xml|z|zip" } });
//--><!]]>
</script>
  
</head>
  
<body>
    <table id="main">
        <tr>
            <td width="100%" class="header">
            	<div class="top-left">
                	<div class="top-right">
                    	<table width="100%">
                            <tr>
                                <td width="100%" style="height:195px;">
                                    <table width="100%">
                                        <tr>
                                            <td width="">
                                                                                                    <a href="../index.html" title="Home"><img src="http://qedcode.com/themes/theme073/images/logo.png" alt="Home" border="0" class="logo" /></a><br />
                                                                                                                                                
                                                                                            </td>
                                            <td width="270">
                                                <div class="search-box">
                                                                                                    </div>
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                            </tr>
                            <tr>
                                <td width="100%" style="height:54px;">
                                                                            <div class="pr-menu">
                                            <ul class="links primary-links"><li class="menu-227 first"><a href="../node.html" title="">Latest Article</a></li>
<li class="menu-339"><a href="../podcast.html" title="Q.E.D. Code Podcast">Podcast</a></li>
<li class="menu-219"><a href="../theory.html" title="">Theory</a></li>
<li class="menu-220"><a href="../practice.html" title="">Practice</a></li>
<li class="menu-221 last"><a href="../speaking.html" title="">Speaking</a></li>
</ul>                                            <br class="clear" />
                                        </div>
                                                                    </td>
                            </tr>
                        </table>
                    </div>
                </div>
            </td>
        </tr>
        <tr>
            <td width="100%">
                <table width="100%" >
                    <tr>
                        <td width="189">
                            <div class="left2">
                                                                    <table width="100%">
                                      <tr>
                                        <td width="100%">
                                            <div class="block block-block" id="block-block-2">
	<div class="block-bot">
    	<div class="block-top">
        	<div class="block-indent">
                <div class="title">
                    <h3>About me</h3>
                </div>
                <div class="content"><div style="margin: 15px;">
<p style="margin-bottom: 7px;">Michael L Perry</p>
<p><a href="http://improvingenterprises.com/"><img src="../images/IE-Logo.png" width="145" alt="Improving Enterprises" /></a></p>
<p style="margin-bottom: 15px;">Principal Consultant</p>
<p><a href="http://twitter.com/michaellperry">@michaellperry</a></p>
</div>
</div>
            </div>
        </div>
    </div>
</div><div class="block block-user" id="block-user-0">
	<div class="block-bot">
    	<div class="block-top">
        	<div class="block-indent">
                <div class="title">
                    <h3>User login</h3>
                </div>
                <div class="content"><form action="http://qedcode.com/content/line-business-applications-xaml?destination=node%2F39"  accept-charset="UTF-8" method="post" id="user-login-form">
<div><div class="form-item" id="edit-name-wrapper">
 <label for="edit-name">Username: <span class="form-required" title="This field is required.">*</span></label>
 <input type="text" maxlength="60" name="name" id="edit-name" size="15" value="" class="form-text required" />
</div>
<div class="form-item" id="edit-pass-wrapper">
 <label for="edit-pass">Password: <span class="form-required" title="This field is required.">*</span></label>
 <input type="password" name="pass" id="edit-pass"  maxlength="60"  size="15"  class="form-text required" />
</div>
<input type="submit" name="op" id="edit-submit" value="Log in"  class="form-submit" />
<div class="item-list"><ul><li class="first last"><a href="../user/password.html" title="Request new password via e-mail.">Request new password</a></li>
</ul></div><input type="hidden" name="form_build_id" id="form-f86de0caf759a136a9f8ae0e8be2efdc" value="form-f86de0caf759a136a9f8ae0e8be2efdc"  />
<input type="hidden" name="form_id" id="edit-user-login-block" value="user_login_block"  />

</div></form>
</div>
            </div>
        </div>
    </div>
</div>                                        </td>
                                      </tr>
                                    </table>
                                                            </div>
                        </td>
                        <td width="0">
                            <div class="right2">
                                                            </div>
                        </td>
                        <td width="" class="cont-row">
                            <div class="border-left">
                                <div class="border-right">
                                    <div class="border-bot">
                                        <div class="border-top">
                                            <div class="corner-bot-left">
                                                <div class="corner-bot-right">
                                                    <div class="corner-top-left">
                                                        <div class="corner-top-right">
                                                            <div class="cent">
                                                                                                                                                                                                
                                                                                                                        
                                                                <h2>Line of business applications in XAML</h2>
                                                                                                                                                                                                                                                                 
                                                                                                                    
                                                                                                                    
                                                              <!-- start main content -->
                                                            <div class="node">
	    <div class="taxonomy"></div>
  
    <div class="content"><p>I spoke at the <a href="http://dallasxaml.com/">Dallas XAML User Group</a> on Tuesday about building line-of-business applications in WPF and Silverlight. This was a hands-on event, so the participants followed along with their own laptops. Please download the source code and try it yourself.</p>
<div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:8eb9d37f-1541-4f29-b6f4-1eea890d4876:82a11187-cc56-446e-8670-99281675cee0" class="wlWriterEditableSmartContent">
<div><a href="http://qedcode.com/sites/default/files/LineofbusinessapplicationsinXAML_986E/CatalogEditor.zip" target="_self">CatalogEditor.zip</a></div>

</div>
<p>The idea behind the talk was to exercise some of the most common features of XAML, Visual Studio, and Blend that are used in a line-of-business application. There are more features in XAML than one person can master. This is the subset that will give you the best return on your learning investment.</p>
<h3>Unit test your view models</h3>
<p>One of the benefits of separation patterns like MVVM is that you can unit test more of your code. Take advantage of it.</p>
<p>You can only unit test code that is in a class library. So it follows that view models should be in class libraries.</p>
<p>View models need to call services to access data and make changes. At run time, these can be WCF, RIA Services, OData feeds, or any other kind of service. But at unit test time, these have to be mocks. There are two reasons for mocking a service in a unit test:</p>
<ul>
<li>Unit tests should run in isolation; they should not pass or fail depending upon the environment. </li>
<li>You need to test that the service gets called appropriately. </li>
</ul>
<p>To mock a service at unit test time, we inject our dependencies. For example:</p>
<pre class="code"><span style="color: blue">public interface </span><span style="color: #2b91af">ICatalogService
</span>{
    <span style="color: #2b91af">List</span>&lt;<span style="color: #2b91af">Product</span>&gt; LoadProducts();
}</pre><pre class="code"><span style="color: blue">public class </span><span style="color: #2b91af">CatalogViewModel
</span>{
    <span style="color: blue">private </span><span style="color: #2b91af">ICatalogService </span>_catalogService;

    <span style="color: blue">public </span>CatalogViewModel(<span style="color: #2b91af">ICatalogService </span>catalogService)
    {
        _catalogService = catalogService;
    }
}</pre><p>By injecting the service into the constructor via an interface, we can provide a real implementation at run time, and a mock implementation at unit test time.</p>
<pre class="code"><span style="color: blue">public class </span><span style="color: #2b91af">MockCatalogService </span>: <span style="color: #2b91af">ICatalogService
</span>{
    <span style="color: blue">public </span><span style="color: #2b91af">List</span>&lt;<span style="color: #2b91af">Product</span>&gt; LoadProducts()
    {
        <span style="color: blue">return new </span><span style="color: #2b91af">List</span>&lt;<span style="color: #2b91af">Product</span>&gt;()
        {
            <span style="color: blue">new </span><span style="color: #2b91af">Product</span>() { Name = <span style="color: #a31515">&quot;Widget&quot; </span>},
            <span style="color: blue">new </span><span style="color: #2b91af">Product</span>() { Name = <span style="color: #a31515">&quot;Gadget&quot; </span>}
        };
    }
}</pre><pre class="code">[<span style="color: #2b91af">TestClass</span>]
<span style="color: blue">public class </span><span style="color: #2b91af">CatalogViewModelTest
</span>{
    <span style="color: blue">private </span><span style="color: #2b91af">CatalogViewModel </span>_catalogViewModel;

    [<span style="color: #2b91af">TestInitialize</span>]
    <span style="color: blue">public void </span>Initialize()
    {
        <span style="color: #2b91af">MockCatalogService </span>mockService = <span style="color: blue">new </span><span style="color: #2b91af">MockCatalogService</span>();
        _catalogViewModel = <span style="color: blue">new </span><span style="color: #2b91af">CatalogViewModel</span>(
            mockService);
        _catalogViewModel.Load();
    }

    [<span style="color: #2b91af">TestMethod</span>]
    <span style="color: blue">public void </span>CanGetProductListFromService()
    {
        <span style="color: blue">var </span>products = _catalogViewModel.Products;
        <span style="color: #2b91af">Assert</span>.AreEqual(2, products.Count());
    }
}</pre><h3></h3>
<h3>Put all views in UserControls</h3>
<p>Don’t use the MainWindow as a view. Don’t drop controls directly into it. Instead, create a new UserControl and build your view in there. Doing so will have several benefits:</p>
<ul>
<li>You can reuse and compose UserControls, but not Windows. </li>
<li>You can switch from one UserControl to another within a Window for simple navigation. </li>
<li>UserControls can be used within a DataTemplate to polymorphically select the view based on the view model. </li>
<li>The container can inject the DataContext into a UserControl, rather than relying upon the view model locator pattern. </li>
</ul>
<p>That last point requires further explanation. We’ve already uses dependency injection to get the service into the view model. We could have used a pattern called “service locator” instead to let the view model find the service itself. Service locator is well documented to have disadvantages when compared to dependency injection.</p>
<p>The view model locator pattern is just another service locator. As such, it suffers from many of the same drawbacks. For example, when the user navigates to a view, they have already selected a specific object. The view model locator must somehow locate that selected object. We end up with a Hail Mary pass, where the selection is stored in one view and retrieved in the locator for another view. If the object was instead injected into the view, it becomes much easier to manage.</p>
<p>To inject the first view model at run time, set the DataContext inside of the main window’s Loaded event.</p>
<pre class="code"><span style="color: blue">private void </span>Window_Loaded(<span style="color: blue">object </span>sender, <span style="color: #2b91af">RoutedEventArgs </span>e)
{
    <span style="color: #2b91af">CatalogViewModel </span>viewModel = <span style="color: blue">new </span><span style="color: #2b91af">CatalogViewModel</span>(
        <span style="color: blue">new </span><span style="color: #2b91af">RealCatalogService</span>());
    viewModel.Load();
    <span style="color: blue">this</span>.DataContext = viewModel;
}</pre><p>From that point forward, you can use properties of the main view model to declaratively inject child view models. DataTemplates come in handy for this.</p>
<h3>Design time data</h3>
<p>There are two ways to use design-time data in Blend with the MVVM pattern. The easy way is to create sample data from a class.</p>
<p><a href="http://qedcode.com/sites/default/files/LineofbusinessapplicationsinXAML_986E/image.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="http://qedcode.com/sites/default/files/LineofbusinessapplicationsinXAML_986E/image_thumb.png" width="222" height="76" /></a> </p>
<p>Select the view model class. Then layout your controls and drag properties onto them to databind.</p>
<p>The second way is to create an object data source.</p>
<p><a href="http://qedcode.com/sites/default/files/LineofbusinessapplicationsinXAML_986E/image_3.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="http://qedcode.com/sites/default/files/LineofbusinessapplicationsinXAML_986E/image_thumb_3.png" width="204" height="138" /></a> </p>
<p>First create a class with one property: the view model. Initialize this view model with a mock service. This mock data will appear at design time.</p>
<pre class="code"><span style="color: blue">public class </span><span style="color: #2b91af">CatalogDesignerData
</span>{
    <span style="color: blue">public </span><span style="color: #2b91af">CatalogViewModel </span>ViewModel
    {
        <span style="color: blue">get
        </span>{
            <span style="color: #2b91af">CatalogViewModel </span>viewModel = <span style="color: blue">new </span><span style="color: #2b91af">CatalogViewModel</span>(
                <span style="color: blue">new </span><span style="color: #2b91af">MockCatalogService</span>());
            viewModel.Load();
            <span style="color: blue">return </span>viewModel;
        }
    }
}</pre><h3>Drag and drop to create list boxes</h3>
<p>If you create sample data from a class, you will be able to drag and drop collections onto the art board. This will automatically generate a ListBox and give it an ItemTemplate. Then you can customize this ItemTemplate using Edit Additional Templates: Edit Generated Items: Edit Current.</p>
<p><a href="http://qedcode.com/sites/default/files/LineofbusinessapplicationsinXAML_986E/image_4.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="http://qedcode.com/sites/default/files/LineofbusinessapplicationsinXAML_986E/image_thumb_4.png" width="646" height="119" /></a> </p>
<p>By default, all properties are added to a StackPanel. If you want a horizontal layout:</p>
<ul>
<li>Set the StackPanel’s Orientation property to Horizontal. </li>
<li>Right-click the StackPanel in the Objects and Timeline view and select Change Layout Type: Grid. </li>
<li>Click the grid ruler to create columns. </li>
<li>Right-click each property and select Auto Size: Fill. </li>
<li>Set all but the last column to Pixel sized. Set the last column to Auto sized. </li>
</ul>
<p>If you want a vertical layout, adjust the Margin of the lower properties to indent them and add spacing between items. Also, adjust the colors and fonts to enhance the contrast of the first property.</p>
<p>If you use the object data source method, Blend will not create a ListBox when you drag and drop. I recommend starting with the simple sample data, then creating an object data source later if you find you need to.</p>
<h3>Use ValueConverters for application-specific view logic</h3>
<p>You might need to represent data using different styles based on its value. For example, positive numbers appear black while negative numbers appear red. Create ValueConverters for these cases.</p>
<pre class="code"><span style="color: blue">public class </span><span style="color: #2b91af">RedWhenNegativeValueConverter </span>: <span style="color: #2b91af">IValueConverter
</span>{
    <span style="color: blue">public object </span>Convert(<span style="color: blue">object </span>value, <span style="color: #2b91af">Type </span>targetType, <span style="color: blue">object </span>parameter, System.Globalization.<span style="color: #2b91af">CultureInfo </span>culture)
    {
        <span style="color: blue">if </span>(targetType != <span style="color: blue">typeof</span>(<span style="color: #2b91af">Brush</span>))
            <span style="color: blue">throw new </span><span style="color: #2b91af">ApplicationException</span>(<span style="color: #a31515">&quot;You must bind to a brush.&quot;</span>);

        <span style="color: blue">decimal </span>decimalValue = (<span style="color: blue">decimal</span>)value;
        <span style="color: blue">if </span>(decimalValue &lt; 0.00m)
            <span style="color: blue">return new </span><span style="color: #2b91af">SolidColorBrush</span>(<span style="color: #2b91af">Colors</span>.Black);
        <span style="color: blue">else
            return new </span><span style="color: #2b91af">SolidColorBrush</span>(<span style="color: #2b91af">Colors</span>.Red);
    }

    <span style="color: blue">public object </span>ConvertBack(<span style="color: blue">object </span>value, <span style="color: #2b91af">Type </span>targetType, <span style="color: blue">object </span>parameter, System.Globalization.<span style="color: #2b91af">CultureInfo </span>culture)
    {
        <span style="color: blue">throw new </span><span style="color: #2b91af">NotImplementedException</span>();
    }
}</pre><p>Data bind the element’s color to the value. Apply value converters in Blend using the advanced properties pane in the binding dialog. Click the ellipsis to create a new instance of the value converter class.</p>
<p>These are the techniques that I find myself using most frequently when building line-of-business applications in WPF and Silverlight. I don’t know everything there is to know about XAML, but by focusing on the features that I find most useful, I’m able to build apps quickly.</p>
</div>
    <br />
        	<div class="links-align">
            <div class="bg-links">
                <div class="links-left">
                    <div class="links-right">
                        <div class="links"><ul class="links inline"><li class="blog_usernames_blog first"><a href="../blogs/michael-l-perry.html" title="Read Michael L Perry&#039;s latest blog entries.">Michael L Perry&#039;s blog</a></li>
<li class="comment_add last"><a href="http://qedcode.com/comment/reply/39#comment-form" title="Share your thoughts and opinions related to this posting.">Add new comment</a></li>
</ul></div>
                    </div>
                </div>
            </div>
        </div>
	    <br class="clear" />    
    </div>                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </td>
                    </tr>
                </table>
            </td>
        </tr>
    </table>
    <div id="footer">
    	<div class="foot">
        	                <span><a rel="license" href="http://creativecommons.org/licenses/by/3.0/us/"><img alt="Creative Commons License" src="../../licensebuttons.net/l/by/3.0/us/88x31.png" /></a><br /><span dc="http://purl.org/dc/elements/1.1/" href="http://purl.org/dc/dcmitype/Text" property="title" rel="type">Q.E.D. Code</span> by <a cc="http://creativecommons.org/ns#" href="../index.html" property="attributionName" rel="attributionURL">Michael L Perry</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/3.0/us/">Creative Commons Attribution 3.0 United States License</a>.</span>
                    </div>
    </div>
<script type="text/javascript">
<!--//--><![CDATA[//><!--
var _gaq = _gaq || [];_gaq.push(["_setAccount", "UA-389401-7"]);_gaq.push(["_trackPageview"]);(function() {var ga = document.createElement("script");ga.type = "text/javascript";ga.async = true;ga.src = ("https:" == document.location.protocol ? "https://ssl" : "http://www") + ".google-analytics.com/ga.js";var s = document.getElementsByTagName("script")[0];s.parentNode.insertBefore(ga, s);})();
//--><!]]>
</script>
</body>

<!-- Mirrored from qedcode.com/content/line-business-applications-xaml by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 13 Jan 2017 12:22:20 GMT -->
</html>
