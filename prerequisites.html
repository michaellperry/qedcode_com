<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en" dir="ltr">

<!-- Mirrored from qedcode.com/prerequisites by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 13 Jan 2017 12:21:16 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Prerequisites | Q.E.D. Code</title>
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="prev" href="content/dependent-and-independent-object-data.html" />
<link rel="up" href="theory.html" />
<link rel="next" href="immutability.html" />
<link rel="shortcut icon" href="http://qedcode.com/misc/favicon.ico" type="image/x-icon" />
  <link type="text/css" rel="stylesheet" media="all" href="http://qedcode.com/modules/book/book.css?2" />
<link type="text/css" rel="stylesheet" media="all" href="http://qedcode.com/modules/node/node.css?2" />
<link type="text/css" rel="stylesheet" media="all" href="http://qedcode.com/modules/system/defaults.css?2" />
<link type="text/css" rel="stylesheet" media="all" href="http://qedcode.com/modules/system/system.css?2" />
<link type="text/css" rel="stylesheet" media="all" href="http://qedcode.com/modules/system/system-menus.css?2" />
<link type="text/css" rel="stylesheet" media="all" href="http://qedcode.com/modules/user/user.css?2" />
<link type="text/css" rel="stylesheet" media="all" href="http://qedcode.com/sites/all/modules/mollom/mollom.css?2" />
<link type="text/css" rel="stylesheet" media="all" href="http://qedcode.com/sites/all/modules/views/css/views.css?2" />
<link type="text/css" rel="stylesheet" media="all" href="http://qedcode.com/modules/comment/comment.css?2" />
<link type="text/css" rel="stylesheet" media="all" href="http://qedcode.com/themes/theme073/style.css?2" />
  <script type="text/javascript" src="http://qedcode.com/misc/jquery.js?2"></script>
<script type="text/javascript" src="http://qedcode.com/misc/drupal.js?2"></script>
<script type="text/javascript" src="http://qedcode.com/sites/all/modules/google_analytics/googleanalytics.js?2"></script>
<script type="text/javascript" src="http://qedcode.com/sites/all/modules/mollom/mollom.js?2"></script>
<script type="text/javascript">
<!--//--><![CDATA[//><!--
jQuery.extend(Drupal.settings, { "basePath": "/", "googleanalytics": { "trackOutbound": 1, "trackMailto": 1, "trackDownload": 1, "trackDownloadExtensions": "7z|aac|arc|arj|asf|asx|avi|bin|csv|doc|exe|flv|gif|gz|gzip|hqx|jar|jpe?g|js|mp(2|3|4|e?g)|mov(ie)?|msi|msp|pdf|phps|png|ppt|qtm?|ra(m|r)?|sea|sit|tar|tgz|torrent|txt|wav|wma|wmv|wpd|xls|xml|z|zip" } });
//--><!]]>
</script>
  
</head>
  
<body>
    <table id="main">
        <tr>
            <td width="100%" class="header">
            	<div class="top-left">
                	<div class="top-right">
                    	<table width="100%">
                            <tr>
                                <td width="100%" style="height:195px;">
                                    <table width="100%">
                                        <tr>
                                            <td width="">
                                                                                                    <a href="index.html" title="Home"><img src="http://qedcode.com/themes/theme073/images/logo.png" alt="Home" border="0" class="logo" /></a><br />
                                                                                                                                                
                                                                                            </td>
                                            <td width="270">
                                                <div class="search-box">
                                                                                                    </div>
                                            </td>
                                        </tr>
                                    </table>
                                </td>
                            </tr>
                            <tr>
                                <td width="100%" style="height:54px;">
                                                                            <div class="pr-menu">
                                            <ul class="links primary-links"><li class="menu-227 first"><a href="node.html" title="">Latest Article</a></li>
<li class="menu-339"><a href="podcast.html" title="Q.E.D. Code Podcast">Podcast</a></li>
<li class="menu-219"><a href="theory.html" title="">Theory</a></li>
<li class="menu-220"><a href="practice.html" title="">Practice</a></li>
<li class="menu-221 last"><a href="speaking.html" title="">Speaking</a></li>
</ul>                                            <br class="clear" />
                                        </div>
                                                                    </td>
                            </tr>
                        </table>
                    </div>
                </div>
            </td>
        </tr>
        <tr>
            <td width="100%">
                <table width="100%" >
                    <tr>
                        <td width="189">
                            <div class="left2">
                                                                    <table width="100%">
                                      <tr>
                                        <td width="100%">
                                            <div class="block block-block" id="block-block-2">
	<div class="block-bot">
    	<div class="block-top">
        	<div class="block-indent">
                <div class="title">
                    <h3>About me</h3>
                </div>
                <div class="content"><div style="margin: 15px;">
<p style="margin-bottom: 7px;">Michael L Perry</p>
<p><a href="http://improvingenterprises.com/"><img src="images/IE-Logo.png" width="145" alt="Improving Enterprises" /></a></p>
<p style="margin-bottom: 15px;">Principal Consultant</p>
<p><a href="http://twitter.com/michaellperry">@michaellperry</a></p>
</div>
</div>
            </div>
        </div>
    </div>
</div><div class="block block-user" id="block-user-0">
	<div class="block-bot">
    	<div class="block-top">
        	<div class="block-indent">
                <div class="title">
                    <h3>User login</h3>
                </div>
                <div class="content"><form action="http://qedcode.com/prerequisites?destination=node%2F4"  accept-charset="UTF-8" method="post" id="user-login-form">
<div><div class="form-item" id="edit-name-wrapper">
 <label for="edit-name">Username: <span class="form-required" title="This field is required.">*</span></label>
 <input type="text" maxlength="60" name="name" id="edit-name" size="15" value="" class="form-text required" />
</div>
<div class="form-item" id="edit-pass-wrapper">
 <label for="edit-pass">Password: <span class="form-required" title="This field is required.">*</span></label>
 <input type="password" name="pass" id="edit-pass"  maxlength="60"  size="15"  class="form-text required" />
</div>
<input type="submit" name="op" id="edit-submit" value="Log in"  class="form-submit" />
<div class="item-list"><ul><li class="first last"><a href="user/password.html" title="Request new password via e-mail.">Request new password</a></li>
</ul></div><input type="hidden" name="form_build_id" id="form-8e4cae1bfa4caa4c101c363ac748bc83" value="form-8e4cae1bfa4caa4c101c363ac748bc83"  />
<input type="hidden" name="form_id" id="edit-user-login-block" value="user_login_block"  />

</div></form>
</div>
            </div>
        </div>
    </div>
</div>                                        </td>
                                      </tr>
                                    </table>
                                                            </div>
                        </td>
                        <td width="0">
                            <div class="right2">
                                                            </div>
                        </td>
                        <td width="" class="cont-row">
                            <div class="border-left">
                                <div class="border-right">
                                    <div class="border-bot">
                                        <div class="border-top">
                                            <div class="corner-bot-left">
                                                <div class="corner-bot-right">
                                                    <div class="corner-top-left">
                                                        <div class="corner-top-right">
                                                            <div class="cent">
                                                                                                                                                                                                
                                                                                                                        
                                                                <h2>Prerequisites</h2>
                                                                                                                                                                                                                                                                 
                                                                                                                    
                                                                                                                    
                                                              <!-- start main content -->
                                                            <div class="node">
	    <div class="taxonomy"></div>
  
    <div class="content"><p>We often have to call methods in a certain order. One method is a prerequisite, the other its successor. For example, we need to validate a shopping cart before we check out. Typically, this is hard to prove.</p>
<pre><span style="color: blue">public</span> <span style="color: blue">class</span> ShoppingCart
{
    <span style="color: gray">/// &lt;summary&gt;</span>
    <span style="color: gray">/// Validate the shopping cart. Throws</span>
    <span style="color: gray">/// ShoppingCartException if there is a problem.</span>
    <span style="color: gray">/// &lt;/summary&gt;</span>
    <span style="color: blue">public</span> <span style="color: blue">void</span> Validate() { }

    <span style="color: gray">/// &lt;summary&gt;</span>
    <span style="color: gray">/// Checkout and provide payment for a shopping</span>
    <span style="color: gray">/// cart. Requires that Validate() is called first.</span>
    <span style="color: gray">/// &lt;/summary&gt;</span>
    <span style="color: gray">/// &lt;param name="paymentMethod"&gt;Method used to pay</span>
    <span style="color: gray">/// for the items in the car.&lt;/param&gt;</span>
    <span style="color: blue">public</span> <span style="color: blue">void</span> Checkout(IPaymentMethod paymentMethod) { }
}</pre><p>The contract is clear, but how do we prove that the caller is following the rules? One way is to keep an internal flag. Set it in Validate(), and check it in Checkout(). If the flag is false, throw an exception.</p>
<p>While this technique works, it is not ideal. It is really no different from a guard clause. It's just a different form of defensive programming. Besides, exceptions are for problems that occur even in well-written software. Calling Checkout() without calling Validate() is a defect, and should never happen at all.</p>
<p><strong>Return from a prerequisite</strong><br />If we change the interface, we can prove the contract at compile time. It won't need to be verified at run time. One way to do this is to put the successor method into the return of its prerequisite.</p>
<pre><span style="color: blue">public</span> <span style="color: blue">interface</span> IValidatedShoppingCart
{
    <span style="color: gray">/// &lt;summary&gt;</span>
    <span style="color: gray">/// Checkout and provide payment for a shopping</span>
    <span style="color: gray">/// cart.</span>
    <span style="color: gray">/// &lt;/summary&gt;</span>
    <span style="color: gray">/// &lt;param name="paymentMethod"&gt;Method used to pay</span>
    <span style="color: gray">/// for the items in the car.&lt;/param&gt;</span>
    <span style="color: blue">void</span> Checkout(IPaymentMethod paymentMethod);
}

<span style="color: blue">public</span> <span style="color: blue">class</span> ShoppingCart
{
    <span style="color: gray">/// &lt;summary&gt;</span>
    <span style="color: gray">/// Validate the shopping cart. Throws</span>
    <span style="color: gray">/// ShoppingCartException if there is a problem.</span>
    <span style="color: gray">/// &lt;/summary&gt;</span>
    <span style="color: blue">public</span> IValidatedShoppingCart Validate() { }
}</pre><p>The compile-time contract is strong enough that it could be removed from the comment. It's obvious to the caller that they have to call Validate() first.</p>
<p><strong>Pass a parameter to the successor</strong><br />Another way to prove the contract as compile time is to pass the prerequisite as a parameter to the successor. We could, for example, prove that the caller needs to get a credit card approved before using it to make a purchase. Here's the hard way.</p>
<pre><span style="color: blue">public</span> <span style="color: blue">class</span> CreditCard : IPaymentMethod
{
    <span style="color: gray">/// &lt;summary&gt;</span>
    <span style="color: gray">/// Create a credit card for a customer.</span>
    <span style="color: gray">/// &lt;/summary&gt;</span>
    <span style="color: gray">/// &lt;param name="customerInfo"&gt;Information</span>
    <span style="color: gray">/// about the card holder.&lt;/param&gt;</span>
    <span style="color: blue">public</span> CreditCard(CustomerInfo customerInfo) { }

    <span style="color: gray">/// &lt;summary&gt;</span>
    <span style="color: gray">/// Request approval for a credit card. If</span>
    <span style="color: gray">/// approved, return the payment. If not,</span>
    <span style="color: gray">/// CreditCardException is thrown.</span>
    <span style="color: gray">/// &lt;/summary&gt;</span>
    <span style="color: blue">public</span> <span style="color: blue">void</span> Approve() { }
}</pre><p>We could set a flag when Approve() is called, and check it when the IPaymentMethod is used. But again, it is defensive. There is a better way.</p>
<pre><span style="color: blue">public</span> <span style="color: blue">class</span> CustomerInfo
{
    <span style="color: gray">/// &lt;summary&gt;</span>
    <span style="color: gray">/// Request approval for a credit card. If</span>
    <span style="color: gray">/// approved, return the payment. If not,</span>
    <span style="color: gray">/// CreditCardException is thrown.</span>
    <span style="color: gray">/// &lt;/summary&gt;</span>
    <span style="color: gray">/// &lt;returns&gt;Payment that can be used to</span>
    <span style="color: gray">/// purchase items.&lt;/returns&gt;</span>
    IPaymentMethod Approve() { }
}</pre><p>We've taken away the ability to create a CreditCard, and hidden it in Approve(). The result of Approve() is a parameter to Checkout(). We've proven that the caller must call the prerequisite before the successor.</p>
<p>A simple rearrangement of interfaces can turn a difficult-to-enforce API into one that the compiler can prove. Just recognize which methods are prerequisites of others, and use their returns to call the successors.</p>
  <div id="book-navigation-3" class="book-navigation">
    
        <div class="page-links clear-block">
              <a href="content/dependent-and-independent-object-data.html" class="page-previous" title="Go to previous page">‹ Dependent and independent object data</a>
                    <a href="theory.html" class="page-up" title="Go to parent page">up</a>
                    <a href="immutability.html" class="page-next" title="Go to next page">Immutability ›</a>
          </div>
    
  </div>
</div>
    <br />
        	<div class="links-align">
            <div class="bg-links">
                <div class="links-left">
                    <div class="links-right">
                        <div class="links"><ul class="links inline"><li class="blog_usernames_blog first"><a href="blogs/michael-l-perry.html" title="Read Michael L Perry&#039;s latest blog entries.">Michael L Perry&#039;s blog</a></li>
<li class="comment_add last"><a href="http://qedcode.com/comment/reply/4#comment-form" title="Share your thoughts and opinions related to this posting.">Add new comment</a></li>
</ul></div>
                    </div>
                </div>
            </div>
        </div>
	    <br class="clear" />    
    </div>                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </td>
                    </tr>
                </table>
            </td>
        </tr>
    </table>
    <div id="footer">
    	<div class="foot">
        	                <span><a rel="license" href="http://creativecommons.org/licenses/by/3.0/us/"><img alt="Creative Commons License" src="../licensebuttons.net/l/by/3.0/us/88x31.png" /></a><br /><span dc="http://purl.org/dc/elements/1.1/" href="http://purl.org/dc/dcmitype/Text" property="title" rel="type">Q.E.D. Code</span> by <a cc="http://creativecommons.org/ns#" href="index.html" property="attributionName" rel="attributionURL">Michael L Perry</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/3.0/us/">Creative Commons Attribution 3.0 United States License</a>.</span>
                    </div>
    </div>
<script type="text/javascript">
<!--//--><![CDATA[//><!--
var _gaq = _gaq || [];_gaq.push(["_setAccount", "UA-389401-7"]);_gaq.push(["_trackPageview"]);(function() {var ga = document.createElement("script");ga.type = "text/javascript";ga.async = true;ga.src = ("https:" == document.location.protocol ? "https://ssl" : "http://www") + ".google-analytics.com/ga.js";var s = document.getElementsByTagName("script")[0];s.parentNode.insertBefore(ga, s);})();
//--><!]]>
</script>
</body>

<!-- Mirrored from qedcode.com/prerequisites by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 13 Jan 2017 12:21:16 GMT -->
</html>
